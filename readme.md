# Телеграм бот скачивания медиатеки

## Сценарий работы:
1. В бот передается сообщения с описанием фильма\сериала. В данной реализации ожидается, что будет пересылаться сообщение из бота [exfreedomist](https://github.com/exfreedomist/telegram_bots). 
2. Бот на основании текста из сообщения, определяет:
	- Наименование, альтернативное наименование;
	- Год выпуска, маркер - является ли фильм сериалом;
	- Магнет ссылку
4. На базе данные из сообщения определяет идентификатор Кинопоиска, посредством API кинопоиска
5. Подготавливает папку для скачивания:
	- Т.к. бот первоначально созадавался под структуру Jellyfin. Каждый фильм скачивается в отдельную папку. По маске "Наименование фильма (год выпуска).kpID. Идентификатор кинопоиска передается, для явного определяния в jellyfin, плагин для кинопоиска от [LinFor](https://github.com/LinFor/jellyfin-plugin-kinopoisk)
	- Если в скачиваемом торренте уже есть папка на верхнем уровне. Такой торрент при скачивание помечается тегом. И далее уже обрабатывается через  [скрипт пост-обработки qbittorent](https://github.com/Rewertkin/rename_folder_by_tag_script_qbittorent)

 
## .env
- KINOPOISK_API - токкен кинопоиска
- TG_BOT_TOKEN - токкен телеграмм бота 
- USER - пользователь qbittorent 
- PASSWORD - пароль пользователя qbittorent 

## config.json
- allowed_users - список id telegramm пользователей, кому разрешен доступ
- addr - адрес qbittorent
- port - порт qbittorent
- default_path - папка по умолчанию, куда будут скачиваться файлы. Для случаев, когда скачивается не медиа файлы, или при обработке сообщения не удалось определить идентификатор кинопоиска
- movies_path - папка для скачивания фильмов
- serials_path - папка для скачивания сериалов